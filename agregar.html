<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agregar Producto</title>
  <link rel="stylesheet" href="agregar.css"/>
  <link rel="icon" href="./icono.png" type="image/png" sizes="100x36"/>

  <style>
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .toggle{display:flex;align-items:center;gap:.5rem;margin-top:.35rem}
    .muted{opacity:.8;font-size:.9rem}
    .inline-help{font-size:.85rem;margin-top:.35rem;color:#444}
    .import-box{margin-top:18px;padding:14px;border:1px dashed #b2bec3;border-radius:10px;background:#f8fafc}
    .import-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .import-row > *{flex:0 0 auto}
    .pill{background:#eef2ff;border:1px solid #c7d2fe;padding:2px 8px;border-radius:999px;font-size:.8rem}

    /* Controles de listado/paginación */
    .list-controls{display:flex;flex-wrap:wrap;gap:.5rem 1rem;align-items:center;margin:.75rem 0 0.5rem}
    .list-controls input[type="search"]{min-width:220px}
    .pager{display:flex;align-items:center;gap:.4rem}
    .pager button{padding:.3rem .55rem}
    .product-list-header{margin-top:.25rem}
    #countInfo{margin-left:auto}

    /* Botón peligro */
    .danger{
      background:#ef4444;color:#fff;border:none;border-radius:6px;
      padding:.45rem .75rem;cursor:pointer
    }
    .danger:hover{filter:brightness(.95)}
  </style>
</head>
<body>
  <header class="header">
    <h1><img src="./icono.png" alt="La Económica" class="logo"></h1>
    <nav class="nav" aria-label="Navegación principal">
      <a href="index.html">Inicio</a>
      <a href="ver.html">Lista de productos</a>
      <a href="agregar.html" aria-current="page">Agregar producto</a>
      <a href="facturacion.html">Facturación</a>
    </nav>
  </header>

  <div class="container" role="main">
    <h1>Agregar Producto a Inventario</h1>

    <!-- Importar CSV -->
    <section class="import-box" aria-labelledby="importar-csv-titulo">
      <h2 id="importar-csv-titulo">Importar desde CSV</h2>
      <p class="inline-help">
        Guarda tu hoja como <span class="pill">CSV (delimitado por comas)</span>. Encabezados aceptados:
        <strong>producto</strong>, <strong>proveedores/ provedores</strong>,
        <strong>facturado</strong>, <strong>facturado x uni</strong>,
        <strong>precio por u</strong>, <strong>precio 1/2 d</strong>,
        <strong>precio por d</strong>, <strong>precio por f</strong>, y (si usas) <strong>precio por libra/arroba/paquete/x99</strong>.
      </p>
      <div class="import-row">
        <input type="file" id="csvFileInput" accept=".csv" aria-label="Seleccionar archivo CSV"/>
        <button class="btn" id="importCsvBtn" type="button">Importar CSV</button>
        <span id="importStatus" class="muted" aria-live="polite"></span>
      </div>
    </section>

    <!-- Formulario manual -->
    <form id="formProducto" novalidate>
      <div class="form-row">
        <div class="form-group">
          <label for="nombre">Nombre del Producto:</label>
          <input type="text" id="nombre" name="nombre" placeholder="Ej. Aceite Ideal 1L" title="Nombre del producto" autocomplete="off" required>
        </div>

        <div class="form-group">
          <label for="proveedor">Proveedor:</label>
          <input type="text" id="proveedor" name="proveedor" placeholder="Ej. Distribuidora JYC" title="Proveedor" autocomplete="off" required>
        </div>

        <div class="form-group">
          <label for="precioFacturado">Precio Facturado:</label>
          <input type="number" id="precioFacturado" name="precioFacturado" placeholder="Ej. 240.00" title="Precio facturado del paquete" inputmode="decimal" step="0.01" min="0" required>
        </div>
      </div>

      <h2 id="precios-venta-legend">Precios de Venta</h2>

      <div class="form-row" role="group" aria-labelledby="precios-venta-legend">
        <div class="form-group">
          <label for="precioUnidad">Unidad (1 unidad):</label>
          <input type="number" id="precioUnidad" name="precioUnidad" placeholder="Ej. 12.50" inputmode="decimal" step="0.01" min="0">
          <div class="toggle">
            <input type="checkbox" id="habilitarPrecioUnidad" checked aria-controls="precioUnidad">
            <label for="habilitarPrecioUnidad">Habilitar precio por unidad</label>
          </div>
        </div>

        <div class="form-group">
          <label for="precioMediaDocena">1/2 Docena (6 unidades):</label>
          <input type="number" id="precioMediaDocena" name="precioMediaDocena" placeholder="Ej. 60.00" inputmode="decimal" step="0.01" min="0">
          <div class="toggle">
            <input type="checkbox" id="habilitarPrecioMediaDocena" checked aria-controls="precioMediaDocena">
            <label for="habilitarPrecioMediaDocena">Habilitar media docena</label>
          </div>
        </div>

        <div class="form-group">
          <label for="precioDocena">Docena (12 unidades):</label>
          <input type="number" id="precioDocena" name="precioDocena" placeholder="Ej. 120.00" inputmode="decimal" step="0.01" min="0">
          <div class="toggle">
            <input type="checkbox" id="habilitarPrecioDocena" checked aria-controls="precioDocena">
            <label for="habilitarPrecioDocena">Habilitar docena</label>
          </div>
        </div>

        <div class="form-group">
          <label for="precioFardo">Fardo:</label>
          <input type="number" id="precioFardo" name="precioFardo" placeholder="Ej. 450.00" inputmode="decimal" step="0.01" min="0">
          <div class="toggle">
            <input type="checkbox" id="habilitarPrecioFardo" checked aria-controls="precioFardo">
            <label for="habilitarPrecioFardo">Habilitar fardo</label>
          </div>
        </div>
      </div>

      <button class="btn" id="agregarProductoBtn" type="button">Agregar Producto</button>
    </form>

    <!-- Controles de búsqueda / lote / paginación -->
    <div class="list-controls" aria-label="Controles de listado">
      <input id="searchBox" type="search" placeholder="Buscar (nombre o proveedor)…" aria-label="Buscar en la lista">
      <label for="batchFilter">Lote:</label>
      <select id="batchFilter" aria-label="Filtrar por lote">
        <option value="">Todos los lotes</option>
      </select>
      <label for="pageSize">Por página:</label>
      <select id="pageSize" aria-label="Tamaño de página">
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="200" selected>200</option>
        <option value="500">500</option>
      </select>
      <div class="pager" role="navigation" aria-label="Paginación">
        <button id="firstPage" type="button" title="Primera página">«</button>
        <button id="prevPage" type="button" title="Anterior">‹</button>
        <span id="pageInfo" class="muted">Página 1/1</span>
        <button id="nextPage" type="button" title="Siguiente">›</button>
        <button id="lastPage" type="button" title="Última">»</button>
      </div>
      <div id="countInfo" class="muted" aria-live="polite"></div>

      <!-- NUEVO: borrar todos los productos -->
      <button id="wipeProducts" type="button" class="danger" title="Eliminar todos los productos del localStorage">
        Borrar todos los productos
      </button>
    </div>

    <!-- Lista -->
    <div class="product-list-container" aria-labelledby="lista-titulo">
      <h2 id="lista-titulo">Productos cargados</h2>
      <div class="product-list-header" role="row">
        <span class="product-name" role="columnheader">Nombre</span>
        <span class="product-provider" role="columnheader">Proveedor</span>
        <span role="columnheader">Precio Facturado</span>
        <span role="columnheader">Unidad</span>
        <span role="columnheader">Media Docena</span>
        <span role="columnheader">Docena</span>
        <span role="columnheader">Fardo</span>
        <span role="columnheader">Acciones</span>
      </div>
      <ul class="product-list" id="productList" role="rowgroup"></ul>
    </div>
  </div>

  <!-- Modal de éxito -->
  <div id="successModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="ok-title" aria-describedby="ok-desc">
    <div class="modal-content">
      <button class="close" aria-label="Cerrar">&times;</button>
      <h3 id="ok-title">¡Listo!</h3>
      <p id="ok-desc">Producto guardado con éxito.</p>
    </div>
  </div>

  <script src="agregar.js"></script>
</body>
</html>
